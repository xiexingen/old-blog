(window.webpackJsonp=window.webpackJsonp||[]).push([[10],{335:function(t,n,a){"use strict";a.r(n);var s=a(1),r=Object(s.a)({},function(){var t=this,n=t.$createElement,a=t._self._c||n;return a("div",{staticClass:"content"},[a("p",[t._v("Docker下安装GitLab\n")]),t._m(0),t._m(1),t._m(2),t._m(3),t._m(4),a("ul",[t._m(5),a("li",[t._v("[2.2] 注册gitlab runner(官方建议跟gitlab不要放在同一个服务器上)【最后没有成功,改用"),a("router-link",{attrs:{to:"07GitLab01-runner.html"}},[t._v("07Gitlab01-runner")]),t._v(" 】"),a("br"),t._v("\n参考地址:https://docs.gitlab.com.cn/runner/register/index.html\n"),t._m(6)],1)]),a("hr"),t._m(7),t._m(8),t._m(9),t._m(10),t._m(11)])},[function(){var t=this.$createElement,n=this._self._c||t;return n("blockquote",[n("p",[this._v("前置条件 安装好docker")])])},function(){var t=this.$createElement,n=this._self._c||t;return n("ol",[n("li",[this._v("docker运行gitlab(由于22端口被ssh占用 改用23)")])])},function(){var t=this,n=t.$createElement,a=t._self._c||n;return a("ul",[a("li",[t._v("在/docker/gitlab 目录下分别创建data、config、logs三个文件夹")]),a("li",[t._v("执行命令"),a("pre",{pre:!0,attrs:{class:"language-docker"}},[a("code",[t._v("sudo docker run "),a("span",{attrs:{class:"token punctuation"}},[t._v("-")]),a("span",{attrs:{class:"token punctuation"}},[t._v("-")]),t._v("detach "),a("span",{attrs:{class:"token punctuation"}},[t._v("-")]),a("span",{attrs:{class:"token punctuation"}},[t._v("-")]),t._v("hostname gitlab.xxgtalk.cn "),a("span",{attrs:{class:"token punctuation"}},[t._v("-")]),a("span",{attrs:{class:"token punctuation"}},[t._v("-")]),t._v("publish 443"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v("443 "),a("span",{attrs:{class:"token punctuation"}},[t._v("-")]),a("span",{attrs:{class:"token punctuation"}},[t._v("-")]),t._v("publish 8090"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v("80 "),a("span",{attrs:{class:"token punctuation"}},[t._v("-")]),a("span",{attrs:{class:"token punctuation"}},[t._v("-")]),t._v("publish 23"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v("22 "),a("span",{attrs:{class:"token punctuation"}},[t._v("-")]),a("span",{attrs:{class:"token punctuation"}},[t._v("-")]),t._v("name gitlab "),a("span",{attrs:{class:"token punctuation"}},[t._v("-")]),a("span",{attrs:{class:"token punctuation"}},[t._v("-")]),t._v("restart always "),a("span",{attrs:{class:"token punctuation"}},[t._v("-")]),t._v("v /docker/gitlab/config"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v("/etc/gitlab "),a("span",{attrs:{class:"token punctuation"}},[t._v("-")]),t._v("v /docker/gitlab/logs"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v("/var/log/gitlab "),a("span",{attrs:{class:"token punctuation"}},[t._v("-")]),t._v("v /docker/gitlab/data"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v("/var/opt/gitlab gitlab/gitlab"),a("span",{attrs:{class:"token punctuation"}},[t._v("-")]),t._v("ce\n* * * * * * 介绍 * * * * * *\nsudo docker run "),a("span",{attrs:{class:"token punctuation"}},[t._v("-")]),a("span",{attrs:{class:"token punctuation"}},[t._v("-")]),t._v("detach \\\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("-")]),a("span",{attrs:{class:"token punctuation"}},[t._v("-")]),t._v("hostname gitlab.xxgtalk.cn \\\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("-")]),a("span",{attrs:{class:"token punctuation"}},[t._v("-")]),t._v("publish 443"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v("443 "),a("span",{attrs:{class:"token punctuation"}},[t._v("-")]),a("span",{attrs:{class:"token punctuation"}},[t._v("-")]),t._v("publish 8090"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v("80 "),a("span",{attrs:{class:"token punctuation"}},[t._v("-")]),a("span",{attrs:{class:"token punctuation"}},[t._v("-")]),t._v("publish 23"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v("22 \\ \n"),a("span",{attrs:{class:"token punctuation"}},[t._v("-")]),a("span",{attrs:{class:"token punctuation"}},[t._v("-")]),t._v("name gitlab \\\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("-")]),a("span",{attrs:{class:"token punctuation"}},[t._v("-")]),t._v("restart always \\\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("-")]),t._v("v /docker/gitlab/config"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v("/etc/gitlab \\ 配置文件映射到config文件夹\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("-")]),t._v("v /docker/gitlab/logs"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v("/var/log/gitlab \\\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("-")]),t._v("v /docker/gitlab/data"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v("/var/opt/gitlab \\\ngitlab/gitlab"),a("span",{attrs:{class:"token punctuation"}},[t._v("-")]),t._v("ce\n")])])])])},function(){var t=this.$createElement,n=this._self._c||t;return n("div",{staticClass:"warning custom-block"},[n("p",{staticClass:"custom-block-title"},[this._v("注意")]),n("ul",[n("li",[this._v("因为配置的ssh端口是23 所以需要修改/docker/gitlab/config/gitlab.rb文件中修改或增加"),n("br"),this._v("\ngitlab_rails['gitlab_shell_ssh_port'] = 23")]),n("li",[this._v("查看日志"),n("br"),this._v("\ndocker logs --follow gitlab")])])])},function(){var t=this.$createElement,n=this._self._c||t;return n("ol",{attrs:{start:"2"}},[n("li",[this._v("docker下安装gitlab runner")])])},function(){var t=this,n=t.$createElement,a=t._self._c||n;return a("li",[t._v("[2.1] 安装gitlab runner"),a("pre",{pre:!0,attrs:{class:"language-docker"}},[a("code",[t._v("docker run "),a("span",{attrs:{class:"token punctuation"}},[t._v("-")]),t._v("d "),a("span",{attrs:{class:"token punctuation"}},[t._v("-")]),a("span",{attrs:{class:"token punctuation"}},[t._v("-")]),t._v("name gitlab"),a("span",{attrs:{class:"token punctuation"}},[t._v("-")]),t._v("runner "),a("span",{attrs:{class:"token punctuation"}},[t._v("-")]),a("span",{attrs:{class:"token punctuation"}},[t._v("-")]),t._v("restart always "),a("span",{attrs:{class:"token punctuation"}},[t._v("-")]),t._v("v /docker/gitlab"),a("span",{attrs:{class:"token punctuation"}},[t._v("-")]),t._v("runner/run/docker.sock"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v("/var/run/docker.sock "),a("span",{attrs:{class:"token punctuation"}},[t._v("-")]),t._v("v /docker/gitlab"),a("span",{attrs:{class:"token punctuation"}},[t._v("-")]),t._v("runner/config"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v("/etc/gitlab"),a("span",{attrs:{class:"token punctuation"}},[t._v("-")]),t._v("runner  gitlab/gitlab"),a("span",{attrs:{class:"token punctuation"}},[t._v("-")]),t._v("runner\n* * * * * * 介绍 * * * * * *\ndocker run "),a("span",{attrs:{class:"token punctuation"}},[t._v("-")]),t._v("d "),a("span",{attrs:{class:"token punctuation"}},[t._v("-")]),a("span",{attrs:{class:"token punctuation"}},[t._v("-")]),t._v("name gitlab"),a("span",{attrs:{class:"token punctuation"}},[t._v("-")]),t._v("runner "),a("span",{attrs:{class:"token punctuation"}},[t._v("-")]),a("span",{attrs:{class:"token punctuation"}},[t._v("-")]),t._v("restart always \\\n  "),a("span",{attrs:{class:"token punctuation"}},[t._v("-")]),t._v("v /docker/gitlab"),a("span",{attrs:{class:"token punctuation"}},[t._v("-")]),t._v("runner/run/docker.sock"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v("/var/run/docker.sock \\\n  "),a("span",{attrs:{class:"token punctuation"}},[t._v("-")]),t._v("v /docker/gitlab"),a("span",{attrs:{class:"token punctuation"}},[t._v("-")]),t._v("runner/config"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v("/etc/gitlab"),a("span",{attrs:{class:"token punctuation"}},[t._v("-")]),t._v("runner  \\\n  gitlab/gitlab"),a("span",{attrs:{class:"token punctuation"}},[t._v("-")]),t._v("runner\n")])])])},function(){var t=this,n=t.$createElement,a=t._self._c||n;return a("ul",[a("li",[t._v("运行下面命令启动注册程序"),a("br"),t._v("\ndocker exec -it gitlab-runner gitlab-runner register")]),a("li",[t._v("输入 GitLab 实例 URL"),a("br"),t._v("\ngitlab的域名")]),a("li",[t._v("输入获取到的用于注册 Runner 的 token:"),a("br"),t._v("\ny8R7nLY4x3mdBiZt9AQV")]),a("li",[t._v("输入该 Runner 的描述，稍后也可通过 GitLab's UI 修改:")]),a("li",[t._v("给该 Runner 指派 tags, 稍后也可以在 GitLab's UI 修改:")]),a("li",[t._v("选择 Runner 是否接收未指定 tags 的任务（默认值：false）， 稍后可以在 GitLab's UI 修改： true")]),a("li",[t._v("选择是否为当前项目锁定该 Runner， 之后也可以在 GitLab's UI 修改。 该功能通常用于被指定为某个项目的 Runner （默认值：true）：")]),a("li",[t._v("选择 Runner executor:"),a("br"),t._v("\n我们使用docker")]),a("li",[t._v("如果你选择 Docker 作为你的 executor，注册程序会让你设置一个默认的镜像， 作用于.gitlab-ci.yml中未指定镜像的项目"),a("br"),t._v("\n输入: microsoft/dotnet")])])},function(){var t=this.$createElement,n=this._self._c||t;return n("h5",{attrs:{id:"搭建私有仓库"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#搭建私有仓库","aria-hidden":"true"}},[this._v("#")]),this._v(" 搭建私有仓库")])},function(){var t=this.$createElement,n=this._self._c||t;return n("ol",[n("li",[this._v("在docker中创建文件夹registry 用来存放仓库镜像，然后运行命令")])])},function(){var t=this,n=t.$createElement,a=t._self._c||n;return a("pre",{pre:!0,attrs:{class:"language-docker"}},[a("code",[t._v("docker run "),a("span",{attrs:{class:"token punctuation"}},[t._v("-")]),t._v("d "),a("span",{attrs:{class:"token punctuation"}},[t._v("-")]),t._v("v /docker/registry"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v("/var/lib/registry "),a("span",{attrs:{class:"token punctuation"}},[t._v("-")]),t._v("p 8091"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v("5000 "),a("span",{attrs:{class:"token punctuation"}},[t._v("-")]),a("span",{attrs:{class:"token punctuation"}},[t._v("-")]),t._v("restart=always "),a("span",{attrs:{class:"token punctuation"}},[t._v("-")]),a("span",{attrs:{class:"token punctuation"}},[t._v("-")]),t._v("name registry registry\n")])])},function(){var t=this.$createElement,n=this._self._c||t;return n("h5",{attrs:{id:"使用docker-compose安装"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#使用docker-compose安装","aria-hidden":"true"}},[this._v("#")]),this._v(" 使用docker-compose安装")])},function(){var t=this.$createElement,n=this._self._c||t;return n("p",[this._v("请查看"),n("a",{attrs:{href:"/post-assets/docker-compose/gitlab-docker-compose.yml"}},[this._v("docker-compose文件")])])}],!1,null,null,null);r.options.__file="07gitlab.md";n.default=r.exports}}]);